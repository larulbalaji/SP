<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Workflow PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<Workflow  explicitTransitions="true"   name="Lifecycle Event - LOA Accounts" type="IdentityLifecycle">
  <Variable input="true" name="identityName">
    <Description>The name of the identity.</Description>
  </Variable>
  <Variable initializer="rule:Rule_ParseApplicationLOAPolicies" name="accountDeprovisioningMap"/>
  <Variable input="true" name="trigger">
    <Description>The IdentityTrigger</Description>
  </Variable>
  <Variable input="true" name="event">
    <Description>The IdentityChangeEvent</Description>
  </Variable>
  <Variable name="userName">
    <Description>The display name of the identity.</Description>
  </Variable>
  <Variable initializer="string:true" name="trace"/>
  <Variable initializer="string:true" name="disableIdentity"/>
  <Variable name="project"/>
  <Variable name="plan"/>

  <Variable initializer="true" name="trace">
    <Description>Set to true for debug output sent to stdout.</Description>
  </Variable>

  <Description>Based on the application attribute settings initiate disable processing.</Description>
  <Step icon="Start" name="Start">
    <Transition to="Set Identity Inactive"/>
 </Step>

  <Step icon="Provision" name="Set Identity Inactive" posX="120" posY="21">
    <Script>
      <Source><![CDATA[
          import sailpoint.object.Identity;
	
		  serilog=org.apache.commons.logging.LogFactory.getLog("SERI.Workflow.LifeCycleEventsLOAAccounts.SetIdentityInactive");

	      serilog.debug("Set Identity Inactive");	
	      Identity identity = (Identity) context.getObject(Identity.class, identityName);
          identity.setInactive(true);
     ]]> </Source>
    </Script>
      <ConditionScript>
        <Source><![CDATA[

		    serilog=org.apache.commons.logging.LogFactory.getLog("SERI.Workflow.LifeCycleEventsLOAAccounts.SetIdentityInactive");
	

			if(disableIdentity== null || disableIdentity.equalsIgnoreCase("false"))
			{
				serilog.debug("Return false to Set Identity Inactive step");
				return false;
			}
			else
			{
			serilog.debug("Return true to Set Identity Inactive step");
			return true;
		    }
	]]>
	</Source>
	    </ConditionScript>
    <Transition to="Initiate Deprovisioning Tasks"/>
  </Step>

  <Step action="rule:Rule_InitiateLOAWorkflows" icon="Default" name="Initiate Deprovisioning Tasks" posX="190" posY="20">
    <Transition to="Stop"/>
  </Step>
  <Step icon="Stop" name="Stop" posX="355" posY="19"/>
</Workflow>
