<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<Rule   language="beanshell" name="Rule - Set old Jobtitle attribute" type="Listener">
 <Description>This rule can be used when the ObjectAttribute being listened to has changed.</Description>
  <Signature returnType="void">
    <Inputs>
      <Argument name="log">
        <Description>
          The log object associated with the SailPointContext.
        </Description>
      </Argument>
      <Argument name="context">
        <Description>
          A sailpoint.api.SailPointContext object that can be used to query the database if necessary.
        </Description>
      </Argument>
      <Argument name="environment">
        <Description>
          Optional arguments passed from the task executor, if the rule is running within a task.
        </Description>
      </Argument>
      <Argument name="identity">
        <Description>
          The identity which owns the attribute.
        </Description>
      </Argument>
      <Argument name="attributeDefinition">
        <Description>
          The definition of the ObjectAttribute.
        </Description>
      </Argument>
      <Argument name="attributeName">
        <Description>
          The name of the ObjectAttribute.
        </Description>
      </Argument>
      <Argument name="oldValue">
        <Description>
          The original value of the ObjectAttribute.
        </Description>
      </Argument>
      <Argument name="newValue">
        <Description>
          The new value of the ObjectAttribute.
        </Description>
      </Argument>
    </Inputs>
  </Signature>
  <Source><![CDATA[

// This rule is used to set an attribute whenever a Jobtitle changes. 
// The attribute is in turn used in the Role Assignment rules (OR condition) to ensure that old access rights can be retained for a period of time.

serilog=org.apache.commons.logging.LogFactory.getLog("SERI.Rule.SetOldJobTitle");

// What workflow should we fire?
String workflowName="xxxx";

   
if(oldValue==null) {
  serilog.debug("No old value: skipping rule");
  return;
} else {
  serilog.debug("oldValue= "+ oldValue );
  identity.setAttribute("oldJobTitle", oldValue);
}

// Now lets start the workflow..... or do we leave this for a normal LCM event trigger?

return;

  ]]></Source>
</Rule>
