<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sailpoint PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<sailpoint>
  <Form name="CreateVendorForm" type="RegisterIdentity">
    <Attributes>
      <Map>
    <entry key="pageTitle" value="Create New Vendor"/>
      </Map>
    </Attributes>
    <Description>This form is used to for self-service registration.</Description>
    <Section type="text">
      <Attributes>
    <Map>
      <entry key="subtitle" value="Please enter the following required information in order to create a new Sailpoint User. When complete, to submit your request, click 'Submit'. To cancel this request, click 'Cancel'."/>
    </Map>
      </Attributes>
      <Field value=" "/>
    </Section>
    <Button action="next" label="register"/>
    <Button action="cancel" label="nav_cancel"/>
    
    <Section label="Employment Information" columns="2">

      <Field displayName="Manager" name="manager" required="false" type="Identity" columnSpan="2">
    <Attributes>
      <Map>
        <entry key="hidden" value="true"/>
      </Map>
    </Attributes>
    <Script>
      <Source><![CDATA[ 
        return launcher;
      ]]></Source>
    </Script>
      </Field>
      <Field displayName="Start Date" name="startDate" required="true" type="date">
    <Script><Source><![CDATA[
    
    
      Calendar x = Calendar.getInstance();
      return x.getTime();  
      
    ]]></Source></Script>
      </Field>
      <Field displayName="End Date" dynamic="true" name="expirationDate" required="true" type="date">
    <Attributes>
      <Map>
      </Map>
    </Attributes>
    <Script>
      <Source>
        <![CDATA[
        if(field.isHidden())
        {
         return null;
        }

        Calendar x = Calendar.getInstance();
        x.add(Calendar.DATE,180);
        return x.getTime();
        ]]>
      </Source>
    </Script>
      </Field>
    </Section>
    
    <Section columns="2" label="User Information"> 
      <Field displayName="First Name" name="firstname" required="true" type="string" columnSpan="2"/>
      <Field displayName="Last Name" name="lastname" postBack="true" required="true" type="string" columnSpan="2"/>
      <Field displayName="Email" name="email" required="true" type="string">
    <Attributes>
      <Map>
        <entry key="vtype" value="email"/>
      </Map>
    </Attributes>
<!--     <Script>
      <Source><![CDATA[
      
        if (form.getField("firstname").getValue() != null && form.getField("lastname").getValue()!= null) {
            return form.getField("firstname").getValue() + "."+  form.getField("lastname").getValue() + "@sailpointdemo.com";
            }
        ]]>    
      </Source>
    </Script> -->
      </Field>
      <Field displayName="Work Phone" name="workPhone" type="string"/> 
      <Field displayName="User Type" name="employeeType" type="string">
              <AllowedValuesDefinition>
          <Script>
            <Source><![CDATA[
List myValues = new ArrayList();
myValues.add("Vendor");
myValues.add("Vendor Administrator");
return myValues;
            ]]></Source>
          </Script>
        </AllowedValuesDefinition>
      
      </Field> 
      
      <Field displayName="Alternate Phone" name="alternatePhone" type="string"/>
    </Section>
    <Section label="Organization Information" columns="2">
      <Field displayName="Company" dynamic="true" helpKey="my help text" name="company" columnSpan="2" required="true" type="string">
    <Attributes>
      <Map>
      </Map>
    </Attributes>
<!--     <Script> -->
<!--       <Source><![CDATA[ -->
<!--       return "SailPoint";  -->
<!--       ]]></Source> -->
<!--     </Script> -->
      </Field>
      <Field displayName="Job Title" name="jobTitle"  required="true" type="string" columnSpan="2">
    <AllowedValuesDefinition>
      <Script>
        <Source><![CDATA[
import sailpoint.object.Rule;
serilog=org.apache.commons.logging.LogFactory.getLog("SERI.Form.CreateVendor");

Map args = new HashMap();
args.put("attributeName","jobTitle");
Rule rule = context.getObjectByName(Rule.class, "Query Identity Attribute Values");
if (rule != null) {
    return context.runRule(rule, args);
} else {
    serilog.debug("Rule is null");
    return true;
}
         
        ]]></Source>
      </Script>
    </AllowedValuesDefinition>
      </Field>
      <Field displayName="Department" dynamic="true" name="department" required="true" type="string" columnSpan="2">
    <AllowedValuesDefinition>
      <Script>
        <Source><![CDATA[
import sailpoint.object.Rule;
Map args = new HashMap();
args.put("attributeName","department");
Rule rule = context.getObjectByName(Rule.class, "Query Identity Attribute Values");
if (rule != null) {return context.runRule(rule, args);} else {return true;}
        ]]> 
        </Source>
      </Script>
    </AllowedValuesDefinition>
      </Field>
      
    </Section>
    <Section columns="2" label="Username Information">    
      <Field displayName="user_name" name="name" required="true" type="string" columnSpan="2" dynamic="true">
    <Script>
      <Source><![CDATA[   
serilog=org.apache.commons.logging.LogFactory.getLog("SERI.Form.CreateVendor");
     
if (form.getField("firstname").getValue() != null && form.getField("lastname").getValue()!= null) {
    return form.getField("firstname").getValue() +"."+form.getField("lastname").getValue();
}

if (form.getField("manager").getValue() != null) {
    serilog.debug("Manger Value:" + form.getField("manager").getValue());
}
    ]]>    
      </Source>
    </Script>
    <ValidationRule>
      <Reference class="sailpoint.object.Rule" name="LCM Validate Identity Name"/>
    </ValidationRule>
      </Field>
      <Field displayName="label_password" name="password" required="true" type="secret">
    <ValidationRule>
      <Reference class="sailpoint.object.Rule" name="LCM Validate Password"/>
    </ValidationRule>
      </Field>
      <Field displayName="label_confirm_password" name="confirmPassword" required="true" type="secret">
    <ValidationScript>
      <Source><![CDATA[     
import java.util.*;
import sailpoint.web.messages.MessageKeys;
import sailpoint.tools.Message;

List errors = null;

String password = form.getField("password").getValue();
String confirmPassword = value;
if (!password.equals(confirmPassword)) {
    errors = new ArrayList();
    Message msg = new Message();
    msg.setKey(MessageKeys.ERROR_IDENTITY_CONFIRM_PASS_MISMATCH);
    errors.add(msg);
}

return errors;
      ]]></Source>
    </ValidationScript>
      </Field>
    </Section>
  </Form>
</sailpoint>

